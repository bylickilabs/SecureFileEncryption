<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Secure File Encryptor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Verschlüsseln Sie Ihre Dateien sicher und lokal im Browser – BYLICKILABS File Encryptor">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    html, body { height: 100%; min-height: 100%; }
    body { min-height: 100vh; background: #f6f9fb; position: relative; padding-bottom: 80px; }
    .app-header {
      width: 100vw;
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 72px;
      background: #fff;
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 18px rgba(30,44,90,0.07);
      padding: 0 2.2vw;
    }
    .header-left { display: flex; align-items: center; }
    .header-logo {
      width: 52px; height: 52px; border-radius: 15px; object-fit: contain;
      border: 2px solid #0dcaf0; background: #fff;
      box-shadow: 0 1px 9px rgba(0,0,0,0.07);
      margin-right: 6px;
    }
    .header-right { display: flex; align-items: center; gap: 15px; }
    .github-link {
      color: #24292e; font-size: 2.1rem; padding-top: 2px; transition: color 0.14s;
    }
    .github-link:hover { color: #0dcaf0; }
    .lang-switch, .toggle-mode {
      border: none; background: #f3f6fa;
      padding: 7px 16px; border-radius: 11px;
      font-weight: 500; font-size: 1.08rem;
      cursor: pointer; transition: background 0.13s;
    }
    .lang-switch:hover, .toggle-mode:hover { background: #e0e8f2; }
    .center-container {
      display: flex; align-items: center; justify-content: center;
      min-height: 100vh;
      padding-top: 95px;
      padding-bottom: 40px;
    }
	  body.bg-dark .lang-switch, body.bg-dark .toggle-mode {
      background: #232a31 !important;
      color: #fff !important;
      border-color: #333 !important;
    }
    .encrypt-card {
      width: 100%;
      max-width: 720px;
      background: #fff;
      border-radius: 2rem;
      box-shadow: 0 6px 38px rgba(40,44,90,0.14), 0 1.5px 5px rgba(10,12,40,0.09);
      padding: 2.7rem 2.1rem 2.1rem 2.1rem;
      margin: 0 auto;
      position: relative;
      animation: fadeIn 0.8s;
    }
    @keyframes fadeIn {
      0% {opacity: 0; transform: translateY(30px);}
      100% {opacity:1; transform: none;}
    }
    .form-label { font-weight: 500; font-size: 1.07rem; }
    .hash-result { font-family: monospace; word-break: break-all; }
    .footer {
      width: 100vw;
      left: 0; bottom: 0; right: 0;
      position: fixed;
      z-index: 11;
      background: #222;
      color: #eee;
      font-size: 1rem;
      padding: 11px 0 8px 0;
      text-align:center;
      box-shadow: 0 -3px 16px rgba(0,0,0,0.14);
    }
    .hash-algo-select {
      width: 100%;
      margin-bottom: 1.2rem;
      font-size: 1rem;
      padding: 0.42rem 0.7rem;
      border-radius: 0.6rem;
      border: 1.5px solid #dee2e6;
      background: #f8fafd;
      color: #23272e;
    }
    @media (max-width:900px) {
      .encrypt-card { max-width: 98vw; }
      .app-header { padding: 0 1vw; }
    }
    @media (max-width:600px) {
      .encrypt-card { padding: 1rem 0.2rem 1rem 0.2rem; border-radius: 0.7rem;}
      .app-header { height: 60px; padding: 0 0.4vw;}
      .header-logo { width:34px; height:34px; border-radius:10px;}
      .footer { font-size:0.92rem;}
      .lang-switch, .toggle-mode { font-size: 0.97rem; padding: 6px 11px;}
    }
  </style>
</head>
<body class="bg-light">
<header class="app-header">
  <div class="header-left">
    <img src="https://upload.wikimedia.org/wikipedia/commons/4/4e/Pleiades_large.jpg" class="header-logo" alt="Logo">
  </div>
  <div class="header-right">
    <a href="https://github.com/bylickilabs" class="github-link" target="_blank" rel="noopener" title="GitHub BYLICKILABS">
      <i class="bi bi-github"></i>
    </a>
    <span class="lang-switch" id="langSwitch" title="Sprache wechseln / Switch language">DE/EN</span>
    <span class="toggle-mode" id="modeSwitch" title="Dark/Lightmode">🌙</span>
  </div>
</header>
<div class="center-container">
  <div class="encrypt-card w3-container w3-card-4" id="main-card">
    <label for="hashAlgo" class="form-label w3-text-grey" id="lbl_hashalgo">Hash-Methode</label>
    <select id="hashAlgo" class="hash-algo-select">
      <option value="SHA-256">SHA-256</option>
      <option value="SHA-1">SHA-1</option>
      <option value="SHA-384">SHA-384</option>
      <option value="SHA-512">SHA-512</option>
      <option value="MD5">MD5</option>
    </select>

    <form id="encryptForm" autocomplete="off">
      <div class="mb-3">
        <label for="fileInput" class="form-label w3-text-grey" id="lbl_file"></label>
        <input class="form-control" type="file" id="fileInput" required>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label w3-text-grey" id="lbl_pw"></label>
        <input class="form-control" type="password" id="password" minlength="8" required autocomplete="new-password">
      </div>
      <button type="submit" class="btn btn-success w3-teal w-100 mb-2" id="btn_encrypt"></button>
      <button type="button" class="btn btn-secondary w-100 mb-2" id="decryptBtn" disabled></button>
    </form>
    <div class="mt-3" id="hashResult" style="display:none;">
      <b id="lbl_hash"></b>
      <div class="hash-result" id="hashValue"></div>
    </div>
    <div class="mt-4 text-muted small">
      <span id="status"></span>
      <br>
      <span id="info_local"></span>
      <br>
      <span class="w3-text-grey">BYLICKILABS &copy; 2025</span>
    </div>
  </div>
</div>
<div class="footer" id="mainfooter">
  <span id="footer_text"></span>
</div>
<script>
const LANGS = {
  de: {
    'lbl_file': 'Datei auswählen',
    'lbl_pw': 'Passwort (mind. 8 Zeichen)',
    'btn_encrypt': 'Datei verschlüsseln & herunterladen',
    'btn_decrypt': 'Entschlüsseln & herunterladen',
    'lbl_hash': 'Hashwert:',
    'lbl_hashalgo': 'Hash-Methode',
    'status_default': '',
    'info_local': '100% lokal & DSGVO-konform.',
    'footer_text': 'Sicher verschlüsseln & speichern mit BYLICKILABS.',
    'file_pw_missing': 'Bitte Datei & sicheres Passwort angeben!',
    'encrypting': 'Verschlüssele...',
    'decrypting': 'Entschlüssele...',
    'success_enc': 'Erfolgreich verschlüsselt & heruntergeladen!',
    'success_dec': 'Erfolgreich entschlüsselt & heruntergeladen!',
    'decrypt_fail': 'Fehler beim Entschlüsseln: ',
    'err_not_encr': 'Kein ENCR-File',
    'err_general': 'Fehler: ',
  },
  en: {
    'lbl_file': 'Select file',
    'lbl_pw': 'Password (min. 8 chars)',
    'btn_encrypt': 'Encrypt & download file',
    'btn_decrypt': 'Decrypt & download',
    'lbl_hash': 'Hash:',
    'lbl_hashalgo': 'Hash method',
    'status_default': '',
    'info_local': '100% local & GDPR compliant.',
    'footer_text': 'Secure encryption & storage by BYLICKILABS.',
    'file_pw_missing': 'Please select a file & enter a secure password!',
    'encrypting': 'Encrypting...',
    'decrypting': 'Decrypting...',
    'success_enc': 'Successfully encrypted & downloaded!',
    'success_dec': 'Successfully decrypted & downloaded!',
    'decrypt_fail': 'Decryption failed: ',
    'err_not_encr': 'Not an ENCR file',
    'err_general': 'Error: ',
  }
};
let currentLang = 'de';
function t(key) {
  return LANGS[currentLang][key] || key;
}
function updateTexts() {
  document.getElementById('lbl_file').textContent = t('lbl_file');
  document.getElementById('lbl_pw').textContent = t('lbl_pw');
  document.getElementById('btn_encrypt').textContent = t('btn_encrypt');
  document.getElementById('decryptBtn').textContent = t('btn_decrypt');
  document.getElementById('lbl_hash').textContent = t('lbl_hash');
  document.getElementById('info_local').textContent = t('info_local');
  document.getElementById('footer_text').textContent = t('footer_text');
  document.getElementById('status').textContent = t('status_default');
  document.getElementById('lbl_hashalgo').textContent = t('lbl_hashalgo');
}
updateTexts();
document.getElementById('langSwitch').onclick = function() {
  currentLang = currentLang === 'de' ? 'en' : 'de';
  updateTexts();
};
let dark = false;
const modeSwitch = document.getElementById('modeSwitch');
modeSwitch.onclick = function() {
  dark = !dark;
  document.body.className = dark ? 'bg-dark text-light' : 'bg-light';
  document.getElementById('main-card').className = dark
    ? 'encrypt-card w3-container w3-card-4 w3-dark-grey'
    : 'encrypt-card w3-container w3-card-4';
  modeSwitch.textContent = dark ? "☀️" : "🌙";
  document.getElementById('mainfooter').style.background = dark ? "#333" : "#222";
  document.getElementById('mainfooter').style.color = dark ? "#eee" : "#eee";
};
const fileInput = document.getElementById('fileInput');
const passwordInput = document.getElementById('password');
const encryptForm = document.getElementById('encryptForm');
const decryptBtn = document.getElementById('decryptBtn');
const hashResult = document.getElementById('hashResult');
const hashValue = document.getElementById('hashValue');
const hashAlgoSelect = document.getElementById('hashAlgo');
const statusMsg = document.getElementById('status');
let encryptedBlob = null;
let decryptedBlob = null;
let lastFileName = '';
let lastMimeType = '';
function toHex(buffer) {
  return Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2,'0')).join('');
}
function md5ArrayBuffer(buf) {
  function rhex(n){var s="",j=0;for(;j<4;j++)s+=("0"+((n>>>(j*8))&255).toString(16)).slice(-2);return s;}
  function cmn(q,a,b,x,s,t){a=((a+b+q+t)|0);return(((a<<s)|(a>>>(32-s)))+x)|0;}
  function ff(a,b,c,d,x,s,t){return cmn((b&c)|((~b)&d),a,b,x,s,t);}
  function gg(a,b,c,d,x,s,t){return cmn((b&d)|(c&(~d)),a,b,x,s,t);}
  function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t);}
  function ii(a,b,c,d,x,s,t){return cmn(c^(b|(~d)),a,b,x,s,t);}
  function md5cycle(x,k){
    var a=x[0],b=x[1],c=x[2],d=x[3];
    a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);
    c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);
    a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);
    c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);
    a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);
    c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);
    a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);
    c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);
    a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);
    c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);
    a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);
    c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);
    a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);
    c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);
    a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);
    c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);
    a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);
    c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);
    a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);
    c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);
    a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);
    c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);
    a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);
    c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);
    a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);
    c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);
    a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);
    c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);
    a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);
    c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);
    a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);
    c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);
    x[0]=(x[0]+a)|0;x[1]=(x[1]+b)|0;x[2]=(x[2]+c)|0;x[3]=(x[3]+d)|0;
  }
  function md51(s) {
    var n=s.length, state=[1732584193,-271733879,-1732584194,271733878], i;
    for(i=64;i<=n;i+=64)md5cycle(state,md5blk(s.substring(i-64,i)));
    s=s.substring(i-64);var tail=Array(16).fill(0);
    for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);
    tail[s.length>>2]|=0x80<<((s.length%4)<<3);
    if(s.length>55){md5cycle(state,tail);tail=Array(16).fill(0);}
    tail[14]=n*8;md5cycle(state,tail);return state;
  }
  function md5blk(s){var md5blks=[],i=0;for(;i<64;i+=4)md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24);return md5blks;}
  function ab2str(buf){return String.fromCharCode.apply(null,new Uint8Array(buf));}
  return rhex(md51(ab2str(buf))[0])+rhex(md51(ab2str(buf))[1])+rhex(md51(ab2str(buf))[2])+rhex(md51(ab2str(buf))[3]);
}
async function hashFile(blob, algo) {
  const ab = await blob.arrayBuffer();
  if (algo === "MD5") {
    return md5ArrayBuffer(ab);
  }
  let method = algo.replace("-", "");
  if (!window.crypto.subtle || (["SHA1", "SHA256", "SHA384", "SHA512"].indexOf(method.toUpperCase()) === -1)) {
    return "Hashmethode nicht unterstützt";
  }
  const hashBuffer = await window.crypto.subtle.digest(algo, ab);
  return toHex(hashBuffer);
}
const encryptFile = async (file, password) => {
  const arrayBuffer = await file.arrayBuffer();
  const salt = window.crypto.getRandomValues(new Uint8Array(16));
  const iv = window.crypto.getRandomValues(new Uint8Array(12));
  const encoder = new TextEncoder();
  const keyMaterial = await window.crypto.subtle.importKey(
    'raw', encoder.encode(password), {name: 'PBKDF2'}, false, ['deriveKey']);
  const key = await window.crypto.subtle.deriveKey({
      name: 'PBKDF2',
      salt: salt,
      iterations: 250000,
      hash: 'SHA-256'
    },
    keyMaterial,
    {name: 'AES-GCM', length: 256},
    false,
    ['encrypt', 'decrypt']
  );
  const encrypted = await window.crypto.subtle.encrypt(
    {name: 'AES-GCM', iv: iv}, key, arrayBuffer
  );
  const magic = new Uint8Array([0x45, 0x4E, 0x43, 0x52]);
  const result = new Uint8Array(4 + 16 + 12 + encrypted.byteLength);
  result.set(magic, 0);
  result.set(salt, 4);
  result.set(iv, 20);
  result.set(new Uint8Array(encrypted), 32);
  return result;
};
const decryptFile = async (blob, password) => {
  const ab = await blob.arrayBuffer();
  const u8 = new Uint8Array(ab);
  if (u8[0] !== 0x45 || u8[1] !== 0x4E || u8[2] !== 0x43 || u8[3] !== 0x52) throw new Error(t('err_not_encr'));
  const salt = u8.slice(4, 20);
  const iv = u8.slice(20, 32);
  const encrypted = u8.slice(32);
  const encoder = new TextEncoder();
  const keyMaterial = await window.crypto.subtle.importKey(
    'raw', encoder.encode(password), {name: 'PBKDF2'}, false, ['deriveKey']);
  const key = await window.crypto.subtle.deriveKey({
      name: 'PBKDF2',
      salt: salt,
      iterations: 250000,
      hash: 'SHA-256'
    },
    keyMaterial,
    {name: 'AES-GCM', length: 256},
    false,
    ['encrypt', 'decrypt']
  );
  const decrypted = await window.crypto.subtle.decrypt(
    {name: 'AES-GCM', iv: iv}, key, encrypted
  );
  return new Blob([decrypted], {type: lastMimeType || 'application/octet-stream'});
};
encryptForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  statusMsg.textContent = t('encrypting');
  hashResult.style.display = "none";
  decryptBtn.disabled = true;
  encryptedBlob = null;
  decryptedBlob = null;
  const file = fileInput.files[0];
  const password = passwordInput.value;
  if (!file || !password || password.length < 8) {
    statusMsg.textContent = t('file_pw_missing');
    return;
  }
  try {
    lastFileName = file.name + ".encr";
    lastMimeType = file.type;
    const enc = await encryptFile(file, password);
    encryptedBlob = new Blob([enc], {type: "application/octet-stream"});
    const hash = await hashFile(encryptedBlob, hashAlgoSelect.value);
    hashResult.style.display = "block";
    hashValue.textContent = hash;
    const url = URL.createObjectURL(encryptedBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = lastFileName;
    a.click();
    URL.revokeObjectURL(url);
    statusMsg.textContent = t('success_enc');
    decryptBtn.disabled = false;
  } catch (err) {
    statusMsg.textContent = t('err_general') + (err.message || err);
  }
});
decryptBtn.addEventListener('click', async () => {
  if (!encryptedBlob) return;
  const password = passwordInput.value;
  statusMsg.textContent = t('decrypting');
  try {
    const dec = await decryptFile(encryptedBlob, password);
    decryptedBlob = dec;
    const url = URL.createObjectURL(decryptedBlob);
    const a = document.createElement('a');
    a.href = url;
    let fname = lastFileName.replace(/\.encr$/, '');
    a.download = fname;
    a.click();
    URL.revokeObjectURL(url);
    statusMsg.textContent = t('success_dec');
  } catch (err) {
    statusMsg.textContent = t('decrypt_fail') + (err.message || err);
  }
});
</script>
</body>
</html>
